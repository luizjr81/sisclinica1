<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:,">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}Cl√≠nica Est√©tica{% endblock %}</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    {% if current_user.is_authenticated %}
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-spa"></i>
                <span>Cl√≠nica Bella</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <ul>
                <li>
                    <a href="{{ url_for('dashboard') }}" class="{% if request.endpoint == 'dashboard' %}active{% endif %}">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                
                <!-- Pacientes - Todos podem acessar -->
                <li>
                    <a href="{{ url_for('patients.list_patients') }}" class="{% if 'patients' in request.endpoint %}active{% endif %}">
                        <i class="fas fa-users"></i>
                        <span>Pacientes</span>
                    </a>
                </li>
                
                <!-- Profissionais - Apenas administradores -->
                {% if has_permission('all') %}
                <li class="nav-section">
                    <span class="nav-section-title">
                        <i class="fas fa-user-md"></i>
                        <span>Equipe</span>
                    </span>
                </li>
                <li>
                    <a href="{{ url_for('professionals.list_professionals') }}" class="{% if 'professionals' in request.endpoint %}active{% endif %}">
                        <i class="fas fa-user-md"></i>
                        <span>Profissionais</span>
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('services.list_services') }}" class="{% if 'services' in request.endpoint %}active{% endif %}">
                        <i class="fas fa-concierge-bell"></i>
                        <span>Servi√ßos</span>
                    </a>
                </li>
                {% endif %}
                
                <!-- Outros m√≥dulos -->
                <li class="nav-section">
                    <span class="nav-section-title">
                        <i class="fas fa-calendar"></i>
                        <span>Atendimento</span>
                    </span>
                </li>
                <li>
                    <a href="#" class="disabled">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Agendamentos</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="disabled">
                        <i class="fas fa-file-medical"></i>
                        <span>Prontu√°rios</span>
                    </a>
                </li>
                
                {% if has_permission('all') %}
                <li class="nav-section">
                    <span class="nav-section-title">
                        <i class="fas fa-chart-line"></i>
                        <span>Gest√£o</span>
                    </span>
                </li>
                <li>
                    <a href="#" class="disabled">
                        <i class="fas fa-dollar-sign"></i>
                        <span>Financeiro</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="disabled">
                        <i class="fas fa-chart-bar"></i>
                        <span>Relat√≥rios</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <img src="https://ui-avatars.com/api/?name={{ current_user.full_name }}&background=e91e63&color=fff" alt="Avatar">
                <div class="user-details">
                    <span class="user-name">{{ current_user.full_name }}</span>
                    <span class="user-role">
                        {% if current_user.role == 'admin' %}
                            <i class="fas fa-crown"></i> Administrador
                        {% elif current_user.role == 'professional' %}
                            <i class="fas fa-user-md"></i> Profissional
                        {% elif current_user.role == 'receptionist' %}
                            <i class="fas fa-desk"></i> Recepcionista
                        {% else %}
                            {{ current_user.role.title() }}
                        {% endif %}
                    </span>
                </div>
            </div>
            <a href="{{ url_for('auth.logout') }}" class="logout-btn" title="Sair">
                <i class="fas fa-sign-out-alt"></i>
            </a>
        </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <h1 class="page-title">{% block page_title %}Dashboard{% endblock %}</h1>
                {% if current_user.role != 'admin' %}
                <span class="user-role-indicator">
                    {% if current_user.role == 'professional' %}
                        <i class="fas fa-user-md"></i> √Årea do Profissional
                    {% elif current_user.role == 'receptionist' %}
                        <i class="fas fa-desk"></i> √Årea da Recep√ß√£o
                    {% endif %}
                </span>
                {% endif %}
            </div>
            <div class="topbar-right">
                <button class="notification-btn">
                    <i class="fas fa-bell"></i>
                    <span class="badge">3</span>
                </button>
                
                <!-- Menu do usu√°rio -->
                <div class="user-menu">
                    <button class="user-menu-toggle" onclick="toggleUserMenu()">
                        <img src="https://ui-avatars.com/api/?name={{ current_user.full_name }}&background=e91e63&color=fff" alt="Avatar">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-menu-dropdown" id="userMenuDropdown">
                        <a href="#" class="disabled">
                            <i class="fas fa-user"></i>
                            Meu Perfil
                        </a>
                        <a href="#" class="disabled">
                            <i class="fas fa-cog"></i>
                            Configura√ß√µes
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="{{ url_for('auth.logout') }}">
                            <i class="fas fa-sign-out-alt"></i>
                            Sair
                        </a>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Page Content -->
        <div class="content-wrapper">
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible">
                            {{ message }}
                            <button type="button" class="close" onclick="this.parentElement.remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            {% block content %}{% endblock %}
        </div>
    </main>
    {% else %}
        {% block auth_content %}{% endblock %}
    {% endif %}
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <script>
    // Toggle do menu do usu√°rio
    function toggleUserMenu() {
        const dropdown = document.getElementById('userMenuDropdown');
        dropdown.classList.toggle('active');
    }
    
    // Fechar menu ao clicar fora
    document.addEventListener('click', function(e) {
        const userMenu = document.querySelector('.user-menu');
        const dropdown = document.getElementById('userMenuDropdown');
        
        if (userMenu && !userMenu.contains(e.target)) {
            dropdown.classList.remove('active');
        }
    });
    </script>
    
    {% block extra_js %}{% endblock %}
    
    <!-- Debug Console para desenvolvimento -->
    {% if config.DEBUG %}
    <script>
        console.log('üè• Sistema Cl√≠nica Est√©tica - Modo Debug');
        console.log('CSRF Token:', document.querySelector('meta[name="csrf-token"]')?.content);
        console.log('Usu√°rio:', {
            name: '{{ current_user.full_name if current_user.is_authenticated }}',
            role: '{{ current_user.role if current_user.is_authenticated }}',
            permissions: '{{ current_user.role if current_user.is_authenticated }}'
        });
    </script>
    {% endif %}
</body>
</html>